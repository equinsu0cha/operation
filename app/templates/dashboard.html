<div class="row" ng-controller="dashBoardController">
    <div class="am-g">
        <div class="tpl-portlet-components">
            <div class="portlet-title">
                <span class="caption font-green bold">系统架构</span>
                <span class="font-green am-inline-block am-margin-right am-icon-refresh am-fr" ng-class="{true: 'am-icon-spin', false: ''}[checking]" ng-click="getInventory()" style="cursor: pointer"></span>
            </div>
            <div class="tpl-block am-g">
                <div class="am-u-sm-5">
                    <div class="am-text-center caption font-green bold am-text-md am-margin-bottom-sm">
                        服务器
                    </div>
                    <ul class="am-avg-sm-1">
                        <li ng-repeat="svr in inventory">
                            <div class="am-panel am-panel-secondary am-radius" style="box-shadow: 3px 5px aliceblue; border-radius: 10px;overflow: hidden;">
                                <div class="am-panel-hd bold">{{::svr.svr_name}} - {{::svr.svr_ip}}</div>
                                <div class="am-panel-bd" style="background-color: floralwhite;">
                                    <ul>
                                        <li ng-repeat="sys in svr.systems">
                                            <span class="caption font-green bold am-text-sm">{{::sys.sys_name}}</span>
                                            <button ng-click="CheckProcVersion(sys.sys_id, CheckProcVersionCallback)" class="am-btn am-btn-xs am-btn-secondary am-round" style="padding: 4px 7px">获取进程版本</button>
                                            <ul class="am-avg-sm-1 am-avg-md-2 am-avg-lg-3">
                                                <li class="am-padding-xs" style="text-align: center;" ng-repeat="proc in sys.processes" on-bind="bindPopup(proc)" repeat-finish>
                                                    <span class="am-badge am-round am-text-truncate am-badge-success" style="line-height: 30px; width: 100%; cursor: help; box-shadow: 3px 3px #ddffcc" id="{{proc.proc_uuid}}">{{::proc.proc_name}}</span>
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="am-u-sm-7">
                    <div ng-controller="customLogController">
                        <div class="am-text-center caption font-green bold am-text-md am-margin-bottom-sm">自定义日志查询</div>
                        <p class="am-text-xs" ng-if="servers.length <= 0">无自定义日志查询</p>
                        <ul ng-if="servers.length > 0">
                            <li ng-repeat="svr in servers">
                                <div>
                                    <span class="font-green bold">{{svr.svr}}</span>
                                    <ul>
                                        <li ng-repeat="log in svr.logs">
                                            <div>
                                                <span class="bold">{{log.log_file}}</span>
                                                <ul class="am-text-sm am-list am-list-striped" style="height: 300px; overflow-y: auto;">
                                                    <li ng-repeat="line in log.results" ng-bind-html="line|html_trust"></li>
                                                </ul>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div ng-controller="customSqlController" style="overflow-x: auto;">
                        <div class="am-text-center caption font-green bold am-text-md am-margin-bottom-sm">自定义数据表查询</div>
                        <p class="am-text-xs" ng-if="dbs.length <= 0">无自定义数据表查询</p>
                        <ul ng-if="dbs.length > 0">
                            <li ng-repeat="db in dbs">
                                <div>
                                    <span class="font-green bold">{{::db.db_host}}_{{::db.db_name}}</span>
                                    <ul>
                                        <li ng-repeat="dt in db.data_tables">
                                            <table class="am-table am-text-xs am-table-striped am-table-hover" style="height: 300px; overflow-y: auto;">
                                                <thead>
                                                    <th ng-repeat="col in dt.formatter">{{::col.name}}</th>
                                                    <th>更新时间</th>
                                                </thead>
                                                <tbody>
                                                    <tr ng-repeat="row in dt.rows">
                                                        <td ng-repeat="col_value in (row|formatterSorter: dt.formatter) track by $index">{{col_value}}</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
